<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standalone Schematic Demo</title>
    <style>
        html, body { height: 100%; margin: 0; padding: 0; }
        body {
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        .header {
            margin-bottom: 20px;
        }
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        #canvas-container {
            flex: 1;
            border: 1px solid #ccc;
            background: #f8f9fa;
            min-height: 0;
        }
        button {
            padding: 8px 16px;
            margin-right: 10px;
            cursor: pointer;
        }
        .info {
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Standalone Schematic Demo</h1>
        <p>This demo imports the Schematic library from the dist folder, as an external application would.</p>
    </div>
    
    <div class="controls">
        <button id="resetBtn">Reset View</button>
        <button id="zoomInBtn">Zoom In</button>
        <button id="zoomOutBtn">Zoom Out</button>
        <span id="zoomLevel" style="margin-left: 20px; font-family: monospace;">Zoom: 1.00x</span>
        <span id="coordinates" style="margin-left: 20px; font-family: monospace;">X: 0, Y: 0</span>
        
        <div class="info">
            Use mouse wheel to zoom in/out â€¢ Right-click + drag to pan
        </div>
    </div>
    
    <div id="canvas-container"></div>

    <!-- Load Fabric.js from CDN (required as peer dependency) -->
    <script src="https://cdn.jsdelivr.net/npm/fabric@6/dist/index.min.js"></script>

    <!-- Import Schematic from dist folder -->
    <script type="module">
        // Import from the dist folder as an external application would
        import { Schematic, Grid, Point } from '../dist/schematic.esm.js';
        
        document.addEventListener('DOMContentLoaded', () => {
            // Get container element
            const container = document.getElementById('canvas-container');
            
            // Initialize schematic with options
            const schematic = new Schematic(container, {
                showGrid: true,
                zoom: 1.0,
                minZoom: 0.1,
                maxZoom: 10
            });
            
            // Get the fabric canvas instance from schematic
            const canvas = schematic.fabric;
            
            // Add some sample objects
            const fabric = window.fabric; // Access fabric from global scope (loaded via CDN)
            
            // Create a circle at origin (0,0)
            const circle = new fabric.Circle({
                left: 0,
                top: 0,
                radius: 50,
                fill: '#e3f2fd',
                stroke: '#2196f3',
                strokeWidth: 2,
                selectable: true,
                originX: 'center',
                originY: 'center'
            });
            canvas.add(circle);
            
            // Create a rectangle
            const rect = new fabric.Rect({
                left: 150,
                top: -100,
                width: 100,
                height: 80,
                fill: '#f3e5f5',
                stroke: '#9c27b0',
                strokeWidth: 2,
                selectable: true,
                originX: 'center',
                originY: 'center'
            });
            canvas.add(rect);
            
            // Create a text object
            const text = new fabric.Text('Schematic Demo', {
                left: -150,
                top: 100,
                fill: '#333',
                fontSize: 20,
                fontFamily: 'Arial',
                originX: 'center',
                originY: 'center'
            });
            canvas.add(text);
            
            // Handle window resize
            const resize = () => {
                const w = container.clientWidth;
                const h = container.clientHeight;
                if (schematic?.mapInstance && typeof schematic.mapInstance.onResize === 'function') {
                    schematic.mapInstance.onResize(w, h);
                }
            };
            
            // Use ResizeObserver if available
            if ('ResizeObserver' in window) {
                const ro = new ResizeObserver(() => resize());
                ro.observe(container);
            } else {
                window.addEventListener('resize', resize);
            }
            
            // Initial sizing
            resize();
            
            // Update UI with coordinates and zoom level
            const updateUI = () => {
                const zoomLevel = document.getElementById('zoomLevel');
                if (zoomLevel) {
                    const zoom = schematic.mapInstance.zoom || 1.0;
                    zoomLevel.textContent = `Zoom: ${zoom.toFixed(2)}x`;
                }
            };
            
            // Update UI when zoom changes
            schematic.on('zoom:change', updateUI);
            
            // Show coordinates on mouse move
            canvas.on('mouse:move', (opt) => {
                const el = canvas.getElement?.() || canvas.upperCanvasEl || canvas.lowerCanvasEl;
                if (!el) return;
                
                const rect = el.getBoundingClientRect();
                const px = opt.e.clientX - rect.left;
                const py = opt.e.clientY - rect.top;
                const vpt = canvas.viewportTransform;
                
                if (!vpt) return;
                
                const worldX = (px - vpt[4]) / vpt[0];
                const worldY = (py - vpt[5]) / vpt[3];
                const gridY = -worldY; // Grid uses inverted Y
                
                const coordsEl = document.getElementById('coordinates');
                if (coordsEl) {
                    coordsEl.textContent = `X: ${worldX.toFixed(2)}, Y: ${gridY.toFixed(2)}`;
                }
            });
            
            // Wire up control buttons
            document.getElementById('resetBtn')?.addEventListener('click', () => {
                schematic.resetView();
                updateUI();
            });
            
            document.getElementById('zoomInBtn')?.addEventListener('click', () => {
                const currentZoom = schematic.mapInstance.zoom || 1.0;
                schematic.setZoom(currentZoom * 1.2);
                updateUI();
            });
            
            document.getElementById('zoomOutBtn')?.addEventListener('click', () => {
                const currentZoom = schematic.mapInstance.zoom || 1.0;
                schematic.setZoom(currentZoom / 1.2);
                updateUI();
            });
            
            // Initial UI update
            updateUI();
        });
    </script>
</body>
</html>
