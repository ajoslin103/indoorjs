/* @preserve
 * IndoorJS 0.2.10+master.1b66ce5, a JS library for interactive indoor maps. https://mudin.github.io/indoorjs
 * (c) 2019 Mudin Ibrahim
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("fabric"),require("eventemitter2")):"function"==typeof define&&define.amd?define(["exports","fabric","eventemitter2"],e):e((t=t||self).Indoor={},t.fabric,t.EventEmitter)}(this,function(t,e,r){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r;var n="0.2.10+master.1b66ce5";function G(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e,n){return(o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&s(o,n.prototype),o}).apply(null,arguments)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?l(t):e}function d(t,e,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function N(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var f=function(t){function s(){var t,e;G(this,s);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];if(1<i.length)t=i[0],e=i[1];else if(0!==i.length&&i[0])if(Object.prototype.hasOwnProperty.call(i[0],"x"))t=i[0].x,e=i[0].y;else if(i[0].length){var r=N(i[0],2);t=r[0],e=r[1]}else console.error("Parameter for Point is not valid. Use Point(x,y) or Point({x,y}) or Point([x,y])",i);else e=t=0;return h(this,u(s).call(this,t,e))}return c(s,fabric.Point),a(s,[{key:"setX",value:function(t){this.x=t||0}},{key:"setY",value:function(t){this.y=t||0}},{key:"getArray",value:function(){return[this.x,this.y]}}]),s}(),v="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function p(){throw new Error("setTimeout has not been defined")}function g(){throw new Error("clearTimeout has not been defined")}var y=p,m=g;function b(e){if(y===setTimeout)return setTimeout(e,0);if((y===p||!y)&&setTimeout)return y=setTimeout,setTimeout(e,0);try{return y(e,0)}catch(t){try{return y.call(null,e,0)}catch(t){return y.call(this,e,0)}}}"function"==typeof v.setTimeout&&(y=setTimeout),"function"==typeof v.clearTimeout&&(m=clearTimeout);var w,x=[],k=!1,O=-1;function j(){k&&w&&(k=!1,w.length?x=w.concat(x):O=-1,x.length&&E())}function E(){if(!k){var t=b(j);k=!0;for(var e=x.length;e;){for(w=x,x=[];++O<e;)w&&w[O].run();O=-1,e=x.length}w=null,k=!1,function(e){if(m===clearTimeout)return clearTimeout(e);if((m===g||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(e);try{m(e)}catch(t){try{return m.call(null,e)}catch(t){return m.call(this,e)}}}(t)}}function L(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];x.push(new C(t,e)),1!==x.length||k||b(E)}function C(t,e){this.fun=t,this.array=e}C.prototype.run=function(){this.fun.apply(null,this.array)};var A=v.performance||{},M=(A.now||A.mozNow||A.msNow||A.oNow||A.webkitNow,function(t){return"number"==typeof t&&!isNaN(t)}),z=function(t,e){var n=(e=e||t.currentTarget).getBoundingClientRect(),i=t.originalEvent||t,o=0,r=0;return t.touches&&t.touches.length?M(t.touches[0].pageX)&&M(t.touches[0].pageY)?(o=t.touches[0].pageX,r=t.touches[0].pageY):M(t.touches[0].clientX)&&M(t.touches[0].clientY)&&(o=i.touches[0].clientX,r=i.touches[0].clientY):M(t.pageX)&&M(t.pageY)?(o=t.pageX,r=t.pageY):t.currentPoint&&M(t.currentPoint.x)&&M(t.currentPoint.y)&&(o=t.currentPoint.x,r=t.currentPoint.y),{x:o-n.left,y:r-n.top}};window.addEventListener("touchmove",function(){});var P=function t(e){var i,o,r,s,a,c,u,l,n,h,d,f=e.source,v=void 0===f?document:f,p=e.update,g=e.multiplier,y=void 0===g?1:g,m=e.friction,b=void 0===m?.92:m,w=e.initialValues,x=e.boundX,k=e.boundY,O=e.bounce,j=void 0===O||O;G(this,t);var E=0,L=0,C=.3*y,A=!1,M=!1,z=!1,P=!1,W=[];function S(){document.removeEventListener("touchmove",T,!!K()&&{passive:!1}),document.removeEventListener("touchend",I),document.removeEventListener("touchcancel",B),document.removeEventListener("mousemove",T,!!K()&&{passive:!1}),document.removeEventListener("mouseup",I)}function R(){p.call(v,E,L)}function Y(t){if("touchmove"!==t.type&&"touchstart"!==t.type&&"touchend"!==t.type)return{x:t.clientX,y:t.clientY,id:null};var e=t.targetTouches[0]||t.changedTouches[0];return{x:e.clientX,y:e.clientY,id:e.identifier}}function X(t){var e=Y(t);M||z||(P=!(M=!0),n=e.id,a=u=e.x,c=l=e.y,W=[],F(a,c),S(),document.addEventListener("touchmove",T,!!K()&&{passive:!1}),document.addEventListener("touchend",I),document.addEventListener("touchcancel",B),document.addEventListener("mousemove",T,!!K()&&{passive:!1}),document.addEventListener("mouseup",I))}function T(t){t.preventDefault();var e=Y(t);M&&e.id===n&&(u=e.x,l=e.y,F(a,c),function(){A||Z(U);A=!0}())}function I(t){var e=Y(t);M&&e.id===n&&B()}function B(){M=!1,F(a,c),function(){var t=W[0],e=W[W.length-1],n=e.x-t.x,i=e.y-t.y,o=(e.time-t.time)/15/y;h=n/o||0,d=i/o||0;var r=Q();(1<Math.abs(h)||1<Math.abs(d)||!r.inBounds)&&(P=!0,Z(q))}(),S()}function F(t,e){for(var n=Date.now();0<W.length&&!(n-W[0].time<=100);)W.shift();W.push({x:t,y:e,time:n})}function U(){var t=u-a,e=l-c;if(E+=t*y,L+=e*y,j){var n=Q();0!==n.x&&(E-=t*D(n.x)*y),0!==n.y&&(L-=e*D(n.y)*y)}else Q(!0);R(),a=u,c=l,A=!1}function D(t){return 5e-6*Math.pow(t,2)+1e-4*t+.55}function Q(t){var e=0,n=0;return void 0!==i&&E<i?e=i-E:void 0!==o&&o<E&&(e=o-E),void 0!==r&&L<r?n=r-L:void 0!==s&&s<L&&(n=s-L),t&&(0!==e&&(E=0<e?i:o),0!==n&&(L=0<n?r:s)),{x:e,y:n,inBounds:0===e&&0===n}}function q(){if(P){E+=h*=b,L+=d*=b;var t=Q();if(Math.abs(h)>C||Math.abs(d)>C||!t.inBounds){if(j){if(0!==t.x)if(t.x*h<=0)h+=.04*t.x;else{var e=0<t.x?2.5:-2.5;h=.11*(t.x+e)}if(0!==t.y)if(t.y*d<=0)d+=.04*t.y;else{var n=0<t.y?2.5:-2.5;d=.11*(t.y+n)}}else 0!==t.x&&(E=0<t.x?i:o,h=0),0!==t.y&&(L=0<t.y?r:s,d=0);R(),Z(q)}else P=!1}}!function(){if(!(v="string"==typeof v?document.querySelector(v):v))throw new Error("IMPETUS: source not found.");if(!p)throw new Error("IMPETUS: update function not defined.");w&&(w[0]&&(E=w[0]),w[1]&&(L=w[1]),R()),x&&(i=x[0],o=x[1]),k&&(r=k[0],s=k[1]),v.addEventListener("touchstart",X),v.addEventListener("mousedown",X)}(),this.destroy=function(){return v.removeEventListener("touchstart",X),v.removeEventListener("mousedown",X),S(),null},this.pause=function(){S(),z=!(M=!1)},this.resume=function(){z=!1},this.setValues=function(t,e){"number"==typeof t&&(E=t),"number"==typeof e&&(L=e)},this.setMultiplier=function(t){C=.3*(y=t)},this.setBoundX=function(t){i=t[0],o=t[1]},this.setBoundY=function(t){r=t[0],s=t[1]}},Z=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};function K(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return K=function(){return t},t}var W=function(t,e){e||(e=[0,""]),t=String(t);var n=parseFloat(t,10);return e[0]=n,e[1]=t.match(/[\d.\-\+]*\s*(.*)/)[1]||"",e},S={ch:8,ex:7.15625,em:16,rem:16,in:96,cm:96/2.54,mm:96/25.4,pt:96/72,pc:16,px:1};function R(t){if(!t)return null;if(S[t])return S[t];var e=W(t);if(isNaN(e[0])||!e[1])return null;var n=R(e[1]);return"number"==typeof n?e[0]*n:null}var Y={left:0,top:0};function X(t,e,n){e=e||t.currentTarget||t.srcElement,Array.isArray(n)||(n=[0,0]);var i,o=t.clientX||0,r=t.clientY||0,s=(i=e)===window||i===document||i===document.body?Y:i.getBoundingClientRect();return n[0]=o-s.left,n[1]=r-s.top,n}function T(u){u=u||window;var l=new r,h=[null,null],d=0,f=0,v=!1,t=!1;return Object.defineProperties(l,{pinching:function(){return 2===d},fingers:function(){return h}}),e(),l.enable=e,l.disable=function(){if(!t)return;t=!1,h[d=0]=null,h[1]=null,f=0,v=!1,u.removeEventListener("touchstart",n,!1),u.removeEventListener("touchmove",i,!1),u.removeEventListener("touchend",o,!1),u.removeEventListener("touchcancel",o,!1)},l.indexOfTouch=p,l;function p(t){for(var e=t.identifier,n=0;n<h.length;n++)if(h[n]&&h[n].touch&&h[n].touch.identifier===e)return n;return-1}function e(){t||(t=!0,u.addEventListener("touchstart",n,!1),u.addEventListener("touchmove",i,!1),u.addEventListener("touchend",o,!1),u.addEventListener("touchcancel",o,!1))}function n(t){for(var e=0;e<t.changedTouches.length;e++){var n=t.changedTouches[e];if(-1===p(n.identifier)&&d<2){var i=0===d,o=h[0]?1:0,r=h[0]?0:1,s=new I;h[o]=s,d++,X(s.touch=n,u,s.position);var a=h[r]?h[r].touch:void 0;if(l.emit("place",n,a),!i){var c=g();v=!1,l.emit("start",c),f=c}}}}function i(t){for(var e=!1,n=0;n<t.changedTouches.length;n++){var i=t.changedTouches[n],o=p(i);-1!==o&&(e=!0,X(h[o].touch=i,u,h[o].position))}if(2===d&&e){var r=g();l.emit("change",r,f),f=r}}function o(t){for(var e=0;e<t.changedTouches.length;e++){var n=t.changedTouches[e],i=p(n);if(-1!==i){h[i]=null,d--;var o=0===i?1:0,r=h[o]?h[o].touch:void 0;l.emit("lift",n,r)}}v||2===d||(v=!0,l.emit("end"))}function g(){return d<2?0:(t=h[0].position,e=h[1].position,n=e[0]-t[0],i=e[1]-t[1],Math.sqrt(n*n+i*i));var t,e,n,i}}function I(){this.position=[0,0],this.touch=null}function B(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var F=0;function U(t){var e=+new Date,n=Math.max(0,16-(e-F));return F=e+n,window.setTimeout(t,n)}var D=window.requestAnimationFrame||B("RequestAnimationFrame")||U,Q=window.cancelAnimationFrame||B("CancelAnimationFrame")||B("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)},q=function(t,e,n){if(!n||D!==U)return D.call(window,function(t,e){var n=Array.prototype.slice;if(t.bind)return t.bind.apply(t,n.call(arguments,1));var i=n.call(arguments,2);return function(){return t.apply(e,i.length?i.concat(n.call(arguments)):arguments)}}(t,e));t.call(e)};q.cancel=function(t){t&&Q.call(window,t)};var H=function(o,n){o instanceof Function&&(n=o,o=document.documentElement||document.body),"string"==typeof o&&(o=document.querySelector(o));var i,r={x:0,y:0},s=0,a=0,c=!0,t=function(t){c=!0};o.addEventListener("mousedown",t),o.addEventListener("mousemove",function(t){r=z(t)}),o.addEventListener("wheel",function(t){t&&(r=z(t))}),o.addEventListener("touchstart",t,!!function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){e=!1}return e}()&&{passive:!0});var u=0,l=0;i=new P({source:o,update:function(t,e){c&&(c=!1,s=r.x,a=r.y);var n={target:o,type:"mouse",dx:t-l,dy:e-u,dz:0,x:r.x,y:r.y,x0:s,y0:a};l=t,u=e,p(n)},multiplier:1,friction:.75});var h,d,f,e=function(t,r,s){"function"==typeof t&&(s=!!r,r=t,t=window);var a=R("ex"),e=function(t){s&&t.preventDefault();var e=t.deltaX||0,n=t.deltaY||0,i=t.deltaZ||0,o=1;switch(t.deltaMode){case 1:o=a;break;case 2:o=window.innerHeight}if(n*=o,i*=o,(e*=o)||n||i)return r(e,n,i,t)};return t.addEventListener("wheel",e),e}(o,function(t,e,n,i){i.preventDefault(),p({target:o,type:"mouse",dx:0,dy:0,dz:e,x:r.x,y:r.y,x0:r.x,y0:r.y})}),v=T(o);function p(e){null==f?f=q(function(){if(n(e),f=null,d){var t=d;d=null,p(t)}}):d?(d.dx+=e.dx,d.dy+=e.dy,d.dz+=e.dz,d.x=e.x,d.y=e.y):d=e}return v.on("start",function(t){var e=v.fingers[0],n=v.fingers[1];h=[.5*n.position[0]+.5*e.position[0],.5*n.position[1]+.5*e.position[1]],i&&i.pause()}),v.on("end",function(){h&&(h=null,i&&i.resume())}),v.on("change",function(t,e){v.pinching&&h&&p({target:o,type:"touch",dx:0,dy:0,dz:2*-(t-e),x:h[0],y:h[1],x0:h[0],y0:h[0]})}),function(){o.removeEventListener("mousedown",t),o.removeEventListener("wheel"),o.removeEventListener("touchstart",t),i.destroy(),o.removeEventListener("wheel",e),v.disable(),q.cancel(f)}};function V(t,e,n){return e<n?Math.max(Math.min(t,n),e):Math.max(Math.min(t,e),n)}var J=Math.abs,_=Math.min;function $(t,e,n,i){var o=J(t-e);return null==n&&(n=$.DBL_EPSILON),null==i&&(i=n),o<=n||(o<=i*_(J(t),J(e))||t===e)}$.FLT_EPSILON=1.1920929e-7,$.DBL_EPSILON=2220446049250313e-31;var tt=Math.log10||function(t){return Math.log(t)/Math.log(10)};function et(t,e,n){var i=t%e;return n||(n=$.FLT_EPSILON),!i||!(!$(0,i,n,0)&&!$(Math.abs(e),Math.abs(i),n,0))}function nt(t,e){var n=Math.floor(tt(t)),i=Math.pow(10,n),o=e.map(function(t){return t*i});i=Math.pow(10,n+1),o=o.concat(e.map(function(t){return t*i}));for(var r=0,s=0;s<o.length&&!(t<=(r=o[s]));s++);return r}var it=function(t){if("[object Object]"!==Object.prototype.toString.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.getPrototypeOf({})},ot=function(t){function n(t){var e;return G(this,n),(e=h(this,u(n).call(this,t)))._options=t||{},Object.assign(l(e),t),e}return c(n,r),n}(),rt="SELECT",st="GRAB",at="DRAW",ct={center:new f,zoom:1,minZoom:0,maxZoom:20,gridEnabled:!0,zoomEnabled:!0,selectEnabled:!0,mode:rt},ut=(new f,{url:"data:image/png;base64,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",size:[128,128],anchor:[64,64]});function lt(t,e){var n=t.replace(/[^\d,]/g,"").split(",");return null==e&&(e=n[3]||1),n[3]=e,"rgba("+n.join(",")+")"}fabric.Object.prototype.originX="center",fabric.Object.prototype.originY="center",fabric.Object.prototype.lockUniScaling=!0,fabric.Object.prototype.lockScalingFlip=!0,fabric.Object.prototype.transparentCorners=!1,fabric.Object.prototype.centeredScaling=!0,fabric.Object.prototype.cornerStyle="circle",fabric.Object.prototype.cornerColor="blue",fabric.Object.prototype.borderColor="blue",fabric.Object.prototype.borderOpacity=.7,fabric.Object.prototype.cornerOpacity=.7,fabric.Object.prototype.cornerStrokeColor="blue",fabric.Object.prototype.borderColor="#2dcfab",fabric.Object.prototype.cornerColor="#2dcfab",fabric.Object.prototype.cornerStrokeColor="#176957",fabric.Object.prototype.objectCaching=!1,fabric.Group.prototype.objectCaching=!0,fabric.Group.prototype.selectionBackgroundColor="rgba(45,207,171,0.25)",fabric.Object.prototype.borderDashArray=[3,3],fabric.Object.prototype.padding=5,fabric.Object.prototype.getBounds=function(){var t=[];return t.push(new f(this.left-this.width/2,this.top-this.height/2)),t.push(new f(this.left+this.width/2,this.top+this.height/2)),t};var ht={steps:[1,2,5],distance:20,unit:10,lines:function(t){var e=t.coordinate,n=t.step=nt(e.distance*e.zoom,e.steps);return function(t,e,n){if(null!=t&&"number"!=typeof t)throw new Error("start must be a number or null");if(null!=e&&"number"!=typeof e)throw new Error("stop must be a number or null");if(null!=n&&"number"!=typeof n)throw new Error("step must be a number or null");null==e&&(e=t||0,t=0),null==n&&(n=t<e?1:-1);for(var i=[],o=t<e;o?t<e:e<t;t+=n)i.push(t);return i}(Math.floor(t.offset/n)*n,Math.ceil((t.offset+t.range)/n+1)*n,n)},lineColor:function(t){if(t.lines){var e=t.coordinate,n=lt(e.color,.1),i=lt(e.color,.3),o=t.step,r=Math.ceil(tt(o)),s=Math.pow(10,r),a=Math.pow(10,r+1),c=o/10;return t.lines.map(function(t){return et(t,a,c)?i:et(t,s,c)?n:null})}},ticks:function(t){if(t.lines){var e=t.coordinate,n=nt(1.1*nt(1.1*t.step,e.steps),e.steps),i=n/10,o=4*t.axisWidth;return t.lines.map(function(t){return et(t,n,i)?$(t,0,i)?null:o:null})}},labels:function(t){if(t.lines){var e=t.coordinate,n=nt(1.1*nt(1.1*t.step,e.steps),e.steps),i=n/10;return t.lines.map(function(t){return et(t,n,i)?$(t,0,i)?"y"===e.orientation?null:"0":(t=Number((t/10).toFixed(2)),e.format(t)):null})}}},dt=function(){function n(t,e){G(this,n),Object.assign(this,e),this.orientation=t||"x"}return a(n,[{key:"getCoords",value:function(t){var e=[];if(!t)return e;for(var n=0;n<t.length;n+=1){var i=this.getRatio(t[n]);e.push(i),e.push(0),e.push(i),e.push(1)}return e}},{key:"getRange",value:function(){var t=this.width;return"y"===this.orientation&&(t=this.height),t*this.zoom}},{key:"getRatio",value:function(t){return(t-this.offset)/this.range}},{key:"setOffset",value:function(t){this.offset=t}},{key:"update",value:function(t){t=t||{},Object.assign(this,t),this.range=this.getRange()}}]),n}(),ft=function(t){function i(t,e){var n;return G(this,i),(n=h(this,u(i).call(this,e))).canvas=t,n.context=n.canvas.getContext("2d"),n.state={},n.setDefaults(),n.update(e),n}return c(i,ot),a(i,[{key:"render",value:function(){return this.draw(),this}},{key:"getCenterCoords",value:function(){var t=this.state.x,e=N(t.shape,2),n=e[0],i=e[1],o=N(t.padding,4),r=o[0],s=o[1],a=o[2],c=o[3],u=t.opposite.coordinate.getCoords([t.coordinate.axisOrigin],t.opposite),l=r+u[1]*(i-r-a),h=N((t=this.state.y).shape,2);n=h[0],i=h[1];var d=N(t.padding,4);return r=d[0],s=d[1],a=d[2],{x:(c=d[3])+(u=t.opposite.coordinate.getCoords([t.coordinate.axisOrigin],t.opposite))[0]*(n-s-c),y:l}}},{key:"setSize",value:function(t,e){this.setWidth(t),this.setHeight(e)}},{key:"setWidth",value:function(t){this.canvas.width=t}},{key:"setHeight",value:function(t){this.canvas.height=t}},{key:"update",value:function(t){t||(t={});var e=[this.canvas.width,this.canvas.height];return this.state.x=this.calcCoordinate(this.axisX,e,this),this.state.y=this.calcCoordinate(this.axisY,e,this),this.state.x.opposite=this.state.y,this.state.y.opposite=this.state.x,this.emit("update",t),this}},{key:"update2",value:function(t){var e=[this.canvas.width,this.canvas.height];Object.assign(this.center,t),this.state.x=this.calcCoordinate(this.axisX,e,this),this.state.y=this.calcCoordinate(this.axisY,e,this),this.state.x.opposite=this.state.y,this.state.y.opposite=this.state.x,this.emit("update",t),this.axisX.offset=t.x,this.axisX.zoom=1/t.zoom,this.axisY.offset=t.y,this.axisY.zoom=1/t.zoom}},{key:"calcCoordinate",value:function(t,e){var n,i,o,r={coordinate:t,shape:e,grid:this};if(r.range=t.getRange(r),r.offset=V(t.offset-r.range*V(.5,0,1),Math.max(t.min,1-Number.MAX_VALUE),Math.min(t.max,Number.MAX_VALUE)-r.range),r.zoom=t.zoom,r.axisColor="number"==typeof t.axisColor?lt(t.color,t.axisColor):t.axisColor||t.color,r.axisWidth=t.axisWidth||t.lineWidth,r.lineWidth=t.lineWidth,r.tickAlign=t.tickAlign,r.labelColor=r.color,"number"==typeof t.padding?r.padding=Array(4).fill(t.padding):t.padding instanceof Function?r.padding=t.padding(r):r.padding=t.padding,"number"==typeof t.fontSize)r.fontSize=t.fontSize;else{var s=W(t.fontSize);r.fontSize=s[0]*R(s[1])}if(r.fontFamily=t.fontFamily||"sans-serif",n=t.lines instanceof Function?t.lines(r):t.lines||[],r.lines=n,t.lineColor instanceof Function)r.lineColors=t.lineColor(r);else if(Array.isArray(t.lineColor))r.lineColors=t.lineColor;else{var a=lt(t.color,t.lineColor);"number"!=typeof t.lineColor&&(a=!1===t.lineColor||null==t.lineColor?null:t.color),r.lineColors=Array(n.length).fill(a)}if(t.ticks instanceof Function)i=t.ticks(r);else if(Array.isArray(t.ticks))i=t.ticks;else{var c=!0===t.ticks||!0===t.ticks?2*r.axisWidth:t.ticks||0;i=Array(n.length).fill(c)}return r.ticks=i,o=!0===t.labels?r.lines:t.labels instanceof Function?t.labels(r):Array.isArray(t.labels)?t.labels:it(t.labels)?t.labels:Array(r.lines.length).fill(null),r.labels=o,it(i)&&(r.ticks=Array(n.length).fill(0)),it(o)&&(r.labels=Array(n.length).fill(null)),it(i)&&Object.keys(i).forEach(function(t,e){r.ticks.push(e),r.lines.push(parseFloat(t)),r.lineColors.push(null),r.labels.push(null)}),it(o)&&Object.keys(o).forEach(function(t,e){r.labels.push(t),r.lines.push(parseFloat(e)),r.lineColors.push(null),r.ticks.push(null)}),r}},{key:"setDefaults",value:function(){this.pixelRatio=window.devicePixelRatio,this.autostart=!0,this.interactions=!0,this.defaults=Object.assign({type:"linear",name:"",units:"",state:{},minZoom:-1/0,maxZoom:1/0,min:-1/0,max:1/0,offset:0,origin:.5,center:{x:0,y:0,zoom:1},zoom:1,zoomEnabled:!0,panEnabled:!0,labels:!0,fontSize:"11pt",fontFamily:"sans-serif",padding:0,color:"rgb(0,0,0,1)",lines:!0,tick:8,tickAlign:.5,lineWidth:1,distance:13,style:"lines",lineColor:.4,axis:!0,axisOrigin:0,axisWidth:2,axisColor:.8,getCoords:function(){return[0,0,0,0]},getRatio:function(){return 0},format:function(t){return t}},ht,this._options),this.axisX=new dt("x",this.defaults),this.axisY=new dt("y",this.defaults),this.axisX=Object.assign({},this.defaults,{orientation:"x",offset:this.center.x,getCoords:function(t,e){var n=[];if(!t)return n;for(var i=0;i<t.length;i+=1){var o=e.coordinate.getRatio(t[i],e);n.push(o),n.push(0),n.push(o),n.push(1)}return n},getRange:function(t){return t.shape[0]*t.coordinate.zoom},getRatio:function(t,e){return(t-e.offset)/e.range}}),this.axisY=Object.assign({},this.defaults,{orientation:"y",offset:this.center.y,getCoords:function(t,e){var n=[];if(!t)return n;for(var i=0;i<t.length;i+=1){var o=e.coordinate.getRatio(t[i],e);n.push(0),n.push(o),n.push(1),n.push(o)}return n},getRange:function(t){return t.shape[1]*t.coordinate.zoom},getRatio:function(t,e){return 1-(t-e.offset)/e.range}}),Object.assign(this,this.defaults),Object.assign(this,this._options),this.center=new f(this.center)}},{key:"draw",value:function(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawLines(this.state.x),this.drawLines(this.state.y),this}},{key:"drawLines",value:function(t){if(t&&t.coordinate){var e=this.context,n=N(t.shape,2),i=n[0],o=n[1],r=N(t.padding,4),s=r[0],a=r[1],c=r[2],u=r[3],l=t.opposite.coordinate.getRatio(t.coordinate.axisOrigin,t.opposite);l=V(l,0,1);var h=t.coordinate.getCoords(t.lines,t);e.lineWidth=1;for(var d=0,f=0;d<h.length;d+=4,f+=1){var v=t.lineColors[f];if(v){e.strokeStyle=v,e.beginPath();var p=0+u+h[d]*(i-a-u),g=0+s+h[d+1]*(o-c-s),y=0+u+h[d+2]*(i-a-u),m=0+s+h[d+3]*(o-c-s);e.moveTo(p,g),e.lineTo(y,m),e.stroke(),e.closePath()}}for(var b,w,x=[],k=0;k<h.length;k+=4){var O=h[k],j=h[k+1],E=h[k+2]-O,L=h[k+3]-j,C=(b=E,w=L,Math.sqrt(b*b+w*w));x.push(E/C),x.push(L/C)}var A=[];t.labelCoords=[];for(var M=t.ticks,z=0,P=0,W=0;z<x.length;W+=1,z+=2,P+=4){var S=h[P],R=h[P+1],Y=(h[P+2]-S)*l,X=(h[P+3]-R)*l,T=[x[z]*M[W]/(i-u-a),x[z+1]*M[W]/(o-s-c)];A.push(x[z]*(Y+T[0]*t.tickAlign)+S),A.push(x[z+1]*(X+T[1]*t.tickAlign)+R),A.push(x[z]*(Y-T[0]*(1-t.tickAlign))+S),A.push(x[z+1]*(X-T[1]*(1-t.tickAlign))+R),t.labelCoords.push(x[z]*Y+S),t.labelCoords.push(x[z+1]*X+R)}if(M.length){e.lineWidth=t.axisWidth/2,e.beginPath();for(var I=0,B=0;I<A.length;I+=4,B+=1)if(!$(t.lines[B],t.opposite.coordinate.axisOrigin)){var F=0+u+A[I]*(i-u-a),U=0+s+A[I+1]*(o-s-c),D=0+u+A[I+2]*(i-u-a),Q=0+s+A[I+3]*(o-s-c);e.moveTo(F,U),e.lineTo(D,Q)}e.strokeStyle=t.axisColor,e.stroke(),e.closePath()}if(t.coordinate.axis&&t.axisColor){var q=t.opposite.coordinate.getCoords([t.coordinate.axisOrigin],t.opposite);e.lineWidth=t.axisWidth/2;var G=0+u+V(q[0],0,1)*(i-a-u),Z=0+s+V(q[1],0,1)*(o-s-c),K=0+u+V(q[2],0,1)*(i-a-u),H=0+s+V(q[3],0,1)*(o-s-c);e.beginPath(),e.moveTo(G,Z),e.lineTo(K,H),e.strokeStyle=t.axisColor,e.stroke(),e.closePath()}this.drawLabels(t)}}},{key:"drawLabels",value:function(t){if(t.labels){var e=this.context,n=N(t.shape,2),i=n[0],o=n[1],r=N(t.padding,4),s=r[0],a=r[1],c=r[2],u=r[3];e.font="300 ".concat(t.fontSize,"px ").concat(t.fontFamily),e.fillStyle=t.labelColor,e.textBaseline="top";for(var l=t.fontSize,h=t.axisWidth+1.5,d=t.tickAlign<.5?-l-2*t.axisWidth:2*t.axisWidth,f="y"===t.coordinate.orientation&&!t.opposite.disabled,v=0;v<t.labels.length;v+=1){var p=t.labels[v];if(null!=p&&(!f||!$(t.lines[v],t.opposite.coordinate.axisOrigin))){var g=e.measureText(p).width,y=t.labelCoords[2*v]*(i-u-a)+h+u;"y"===t.coordinate.orientation&&(y=V(y,h,i-g-1-t.axisWidth),p*=-1);var m=t.labelCoords[2*v+1]*(o-s-c)+d+s;"x"===t.coordinate.orientation&&(m=V(m,0,o-l-d)),e.fillText(p,y,m)}}}}}]),i}(),vt=function(e){return function(t){function n(t){var e;return G(this,n),e=h(this,u(n).call(this,t)),console.log("modesMixin"),e}return c(n,e),a(n,[{key:"setMode",value:function(t){switch(this.mode=t){case rt:this.canvas.isDrawingMode=!1,this.canvas.interactive=!0,this.canvas.selection=!0,this.canvas.hoverCursor="default",this.canvas.moveCursor="default",this.canvas.setCursor("default");break;case st:this.canvas.isDrawingMode=!1,this.canvas.interactive=!1,this.canvas.selection=!1,this.canvas.discardActiveObject(),this.canvas.hoverCursor="move",this.canvas.moveCursor="move",this.canvas.setCursor("move");break;case at:this.canvas.isDrawingMode=!0}}},{key:"setModeAsDraw",value:function(){this.setMode(at),console.log("MODE: DRAW")}},{key:"setModeAsSelect",value:function(){this.setMode(rt),console.log("MODE: SELECT")}},{key:"setModeAsGrab",value:function(){this.setMode(st),console.log("MODE: GRAB")}},{key:"isSelectMode",value:function(){return this.mode===rt}},{key:"isGrabMode",value:function(){return this.mode===st}},{key:"isDrawMode",value:function(){return this.mode===at}}]),n}()},pt=function(t){return new gt(t)},gt=function(){function e(t){G(this,e),this.superclass=t||function(){return function t(){G(this,t)}}()}return a(e,[{key:"with",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce(function(t,e){return e(t)},this.superclass)}}]),e}(),yt=function(t){function r(t,e){var n;G(this,r),(n=h(this,u(r).call(this,e))).defaults=Object.assign({},ct),Object.assign(l(n),n.defaults),Object.assign(l(n),n._options),n.center=new f(n.center),n.container=t||document.body;var i=document.createElement("canvas");n.container.appendChild(i),i.setAttribute("id","indoors-map-canvas"),i.width=n.width||n.container.clientWidth,i.height=n.height||n.container.clientHeight,n.canvas=new fabric.Canvas(i,{preserveObjectStacking:!0}),n.context=n.canvas.getContext("2d"),n.on("render",function(){n.autostart&&n.clear()}),n.originX=-n.canvas.width/2,n.originY=-n.canvas.height/2,n.canvas.absolutePan({x:n.originX,y:n.originY}),n.x=n.center.x,n.y=n.center.y,n.dx=0,n.dy=0;try{n.addFloorPlan()}catch(t){console.error(t)}n.addGrid(),n.setMode(n.mode||st);var o=l(n);return H(n.container,function(t){o.panzoom(t)}),n.registerListeners(),setTimeout(function(){n.emit("ready",l(n))},300),n}return c(r,pt(ot)["with"](vt)),a(r,[{key:"addFloorPlan",value:function(){if(this.floorplan){var e=this;this.floorplan.on("load",function(t){e.addLayer(t)})}}},{key:"addLayer",value:function(t){t.shape?(this.canvas.add(t.shape),this.canvas._objects.sort(function(t,e){return t.zIndex-e.zIndex}),t.shape.keepOnZoom&&(t.shape._set("scaleX",1/this.zoom),t.shape._set("scaleY",1/this.zoom),this.emit("".concat(t.class,"scaling"),t))):console.error("shape is undefined")}},{key:"removeLayer",value:function(t){this.canvas.remove(t.shape)}},{key:"addGrid",value:function(){this.gridCanvas=this.cloneCanvas(),this.gridCanvas.setAttribute("id","indoors-grid-canvas"),this.grid=new ft(this.gridCanvas,this),this.grid.draw()}},{key:"moveTo",value:function(t,e){void 0!==e&&(t.zIndex=e),this.canvas.moveTo(t.shape,t.zIndex)}},{key:"cloneCanvas",value:function(t){t=t||this.canvas;var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.wrapperEl.appendChild(e),e}},{key:"setZoom",value:function(t){var e=this,n=this.canvas,i=n.width,o=n.height;this.zoom=V(t,this.minZoom,this.maxZoom),this.dx=0,this.dy=0,this.x=i/2,this.y=o/2,this.update(),L(function(){e.update()})}},{key:"getBounds",value:function(){var e=1/0,n=-1/0,i=1/0,o=-1/0;return this.canvas.forEachObject(function(t){t.getBounds().forEach(function(t){e=Math.min(e,t.x),n=Math.max(n,t.x),i=Math.min(i,t.y),o=Math.max(o,t.y)})}),[new f(e,i),new f(n,o)]}},{key:"fitBounds",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100;this.onResize();var n=this.canvas,i=n.width,o=n.height;this.originX=-this.canvas.width/2,this.originY=-this.canvas.height/2;var r=this.getBounds();this.center.x=(r[0].x+r[1].x)/2,this.center.y=-(r[0].y+r[1].y)/2;var s=i/(Math.abs(r[0].x-r[1].x)+e),a=o/(Math.abs(r[0].y-r[1].y)+e);this.zoom=Math.min(s,a),this.canvas.setZoom(this.zoom),this.canvas.absolutePan({x:this.originX+this.center.x*this.zoom,y:this.originY-this.center.y*this.zoom}),this.update(),L(function(){t.update()})}},{key:"reset",value:function(){var t=this,e=this.canvas,n=e.width,i=e.height;this.zoom=this._options.zoom||1,this.center=new f,this.originX=-this.canvas.width/2,this.originY=-this.canvas.height/2,this.canvas.absolutePan({x:this.originX,y:this.originY}),this.x=n/2,this.y=i/2,this.update(),L(function(){t.update()})}},{key:"onResize",value:function(t,e){var n=this.canvas.width,i=this.canvas.height;t=t||this.container.clientWidth,e=e||this.container.clientHeight,this.canvas.setWidth(t),this.canvas.setHeight(e),this.grid.setSize(t,e);var o=t/2-n/2,r=e/2-i/2;this.canvas.relativePan({x:o,y:r}),this.update()}},{key:"update",value:function(){var t=this.canvas;this.grid.update2({x:this.center.x,y:this.center.y,zoom:this.zoom}),this.emit("update",this),this.grid.render(),t.zoomToPoint(new f(this.x,this.y),this.zoom),this.isGrabMode()&&(t.relativePan(new f(this.dx,this.dy)),this.emit("panning"));for(var e=t.getObjects(),n=0;n<e.length;n+=1){var i=e[n];i.keepOnZoom&&(i._set("scaleX",1/this.zoom),i._set("scaleY",1/this.zoom),this.emit("".concat(i.class,"scaling"),i))}}},{key:"panzoom",value:function(t){var e=this.canvas,n=e.width,i=e.height,o=V(-t.dz,.75*-i,.75*i)/i,r=1/this.zoom,s=r*(1-o);s=V(s,this.minZoom,this.maxZoom);var a=this.center,c=a.x,u=a.y;(this.isGrabMode()&&(c-=r*t.dx,u+=r*t.dy),this.zoomEnabled)&&(c-=n*(s-r)*(t.x/n-.5),u-=i*(s-r)*(.5-t.y/i));this.center.setX(c),this.center.setY(u),this.zoom=1/s,this.dx=t.dx,this.dy=t.dy,this.x=t.x0,this.y=t.y0,this.update()}},{key:"registerListeners",value:function(){var r=this,s=this;this.canvas.on("object:scaling",function(t){if(t.target.class)s.emit("".concat(t.target.class,":scaling"),t.target.parent);else{var e=t.target;if(e.getObjects){var n=e.getObjects();e.removeWithUpdate();for(var i=0;i<n.length;i+=1){var o=n[i];o.fire("moving",o.parent),s.emit("".concat(o.class,":moving"),o.parent)}s.update(),s.canvas.renderAll()}}}),this.canvas.on("object:rotating",function(t){if(t.target.class)s.emit("".concat(t.target.class,":rotating"),t.target.parent);else{var e=t.target;if(e.getObjects){for(var n=e.getObjects(),i=0;i<n.length;i+=1){var o=n[i];o.class&&(o._set("angle",-e.angle),o.fire("moving",o.parent),s.emit("".concat(o.class,":moving"),o.parent))}r.update()}}}),this.canvas.on("object:moving",function(t){if(t.target.class)s.emit("".concat(t.target.class,":moving"),t.target.parent);else{var e=t.target;if(e.getObjects){for(var n=e.getObjects(),i=0;i<n.length;i+=1){var o=n[i];o.class&&(o.fire("moving",o.parent),s.emit("".concat(o.class,":moving"),o.parent))}r.update()}}}),this.canvas.on("object:moved",function(t){t.target.class&&s.emit("".concat(t.target.class,"dragend"),t),r.update()}),this.canvas.on("selection:cleared",function(t){var e=t.deselected;if(e&&e.length)for(var n=0;n<e.length;n+=1){var i=e[n];i.class&&(i._set("angle",0),i._set("scaleX",1/s.zoom),i._set("scaleY",1/s.zoom),i.parent&&(i.parent.selected=!1),i.fire("moving",i.parent))}}),this.canvas.on("selection:created",function(t){console.log(t);var e=t.selected;if(e&&e.length)for(var n=0;n<e.length;n+=1){var i=e[n];i.class&&i.parent&&(i.parent.selected=!0)}}),this.canvas.on("mouse:down",function(t){s.dragObject=t.target}),this.canvas.on("mouse:move",function(t){s.dragObject&&s.dragObject.clickable&&(s.dragObject===t.target?s.dragObject.dragging=!0:s.dragObject.dragging=!1)}),this.canvas.on("mouse:up",function(t){if(s.dragObject&&s.dragObject.clickable){if(s.dragObject!==t.target)return;s.dragObject.dragging||s.modeToggleByKey||(console.log("click"),s.emit("".concat(s.dragObject.class,":click"),s.dragObject.parent)),s.dragObject.dragging=!1}s.dragObject=null}),window.addEventListener("resize",function(){s.onResize()}),document.addEventListener("keyup",function(){r.modeToggleByKey&&r.isGrabMode()&&(r.setModeAsSelect(),r.modeToggleByKey=!1)}),document.addEventListener("keydown",function(t){(t.ctrlKey||t.metaKey)&&(r.isSelectMode()&&r.setModeAsGrab(),r.modeToggleByKey=!0)})}},{key:"unregisterListeners",value:function(){this.canvas.off("object:moving"),this.canvas.off("object:moved")}},{key:"getMarkerById",value:function(t){for(var e=this.canvas.getObjects(),n=0;n<e.length;n+=1){var i=e[n];if("marker"===i.class&&i.id===t)return i.parent}return null}},{key:"getMarkers",value:function(){for(var t=[],e=this.canvas.getObjects(),n=0;n<e.length;n+=1){var i=e[n];"marker"===i.class&&t.push(i.parent)}return t}}]),r}(),mt=function(t){function n(t,e){return G(this,n),e=e||{},h(this,u(n).call(this,t,e))}return c(n,fabric.Group),a(n,[{key:"getBounds",value:function(){var t=[];return t.push(new f(this.left-this.width/2,this.top-this.height/2)),t.push(new f(this.left+this.width/2,this.top+this.height/2)),t}}]),n}(),bt=function(t){function n(t){var e;return G(this,n),(e=h(this,u(n).call(this,t))).label=void 0!==e.label?e.label:null,e.draggable=e.draggable||!1,e.zIndex=e.zIndex||1,e.opacity=e.opacity||1,e.keepOnZoom=e.keepOnZoom||!1,e.clickable=e.clickable||!1,e.hoverCursor=e.hoverCursor||e.clickable?"pointer":"default",e.moveCursor=e.moveCursor||"move",e.class=e.class||e.constructor.name.toLowerCase(),e.style={zIndex:e.zIndex,class:e.class,parent:l(e),keepOnZoom:e.keepOnZoom,id:e.id,hasControls:!1,hasBorders:!1,lockMovementX:!e.draggable,lockMovementY:!e.draggable,draggable:e.draggable,clickable:e.clickable,selectable:e.draggable,hoverCursor:e.hoverCursor,moveCursor:e.moveCursor},e}return c(n,ot),a(n,[{key:"addTo",value:function(t){t?(this._map=t,this._map.addLayer(this)):this._map&&this._map.removeLayer(this)}}]),n}(),wt=function(t){function i(t){var e;G(this,i),(e=h(this,u(i).call(this,t))).width=e.width||-1,e.height=e.height||-1,e.position=new f(e.position),e.class="floorplan";var n=l(e);return fabric.Image.fromURL(e.url,function(t){var e=t.width/t.height;-1===n.width&&-1===n.height?(n.width=t.width,n.height=t.height):-1===n.width?n.width=n.height/e:-1===n.height&&(n.height=n.width*e),t.originalWidth=t.width,t.originalHeight=t.height,n.image=t.scaleToWidth(n.width),n.scaleX=t.scaleX+0,n.scaleY=t.scaleY+0,n.shape=new mt([n.image,n.handler],{selectable:!1,draggable:!1,left:n.position.x,top:n.position.y,parent:n,lockMovementX:!0,lockMovementY:!0,class:n.class,zIndex:n.zIndex}),n.emit("load",n)},{selectable:!1,opacity:e.opacity}),e.handler=new fabric.Rect({left:0,top:0,width:20,height:20,stroke:"green",fill:"",hasControls:!1,hasBorders:!1}),e}return c(i,bt),i}(),xt=function(t){function i(t,e){var n;return G(this,i),(e=e||{}).strokeWidth=e.strokeWidth||1,(n=h(this,u(i).call(this,t,e)))._strokeWidth=e.strokeWidth,n}return c(i,fabric.Line),a(i,[{key:"_renderStroke",value:function(t){this.strokeWidth=this._strokeWidth/this.canvas.getZoom(),d(u(i.prototype),"_renderStroke",this).call(this,t)}}]),i}(),kt=function(t){function o(t,e,n){var i;return G(this,o),(n=n||{}).zIndex=n.zIndex||9,i=h(this,u(o).call(this,n)),t&&e?(i.start=t,i.end=e,i.strokeWidth=i.strokeWidth||1,Object.assign(i.style,{strokeWidth:i.strokeWidth,stroke:i.color||"grey",fill:i.fill||!1,selectable:!1}),i.draw(),i.registerListeners(),i):(console.error("start or end is missing"),h(i))}return c(o,bt),a(o,[{key:"registerListeners",value:function(){var t=this;this.start.on("update:links",function(){t.shape.set({x1:t.start.position.x,y1:t.start.position.y})}),this.end.on("update:links",function(){t.shape.set({x2:t.end.position.x,y2:t.end.position.y})})}},{key:"draw",value:function(){this.shape=new xt([this.start.position.x,this.start.position.y,this.end.position.x,this.end.position.y],this.style)}},{key:"redraw",value:function(){this.shape.set({x1:this.start.position.x,y1:this.start.position.y,x2:this.end.position.x,y2:this.end.position.y})}},{key:"setStart",value:function(t){this.start=t,this.redraw()}},{key:"setEnd",value:function(t){this.end=t,this.redraw()}}]),o}(),Ot=function(t){function o(t,e){var n;G(this,o),(e=e||{}).zIndex=e.zIndex||10,e.keepOnZoom=!0,e.position=new f(t),e.rotation=e.rotation||0,e.clickable=e.clickable||!0;var i=l(n=h(this,u(o).call(this,e)));return n.text=n.text||"",n.size=n.size||10,Object.assign(n.style,{left:n.position.x,top:n.position.y,selectionBackgroundColor:!1,angle:n.rotation}),n.text&&(n.textObj=new fabric.Text(n.text,{fontSize:n.size})),n.icon?fabric.Image.fromURL(n.icon.url,function(t){i.image=t.scaleToWidth(100),n.init()},{selectable:!0,opacity:n.opacity}):(n.circle=new fabric.Circle({radius:n.size,strokeWidth:2,stroke:"red",fill:"white"}),n.init()),n}return c(o,bt),a(o,[{key:"init",value:function(){var t=this,e=[];this.image&&e.push(this.image),this.circle&&e.push(this.circle),this.textObj&&e.push(this.textObj),this.shape=new mt(e,this.style),this.links=this.links||[],this.addLinks(),this.registerListeners(),L(function(){t.emit("ready")})}},{key:"registerListeners",value:function(){var e=this;this.shape.on("moving",function(){e.onShapeDrag()}),this.shape.on("mousedown",function(t){e.onShapeMouseDown(t)}),this.shape.on("mousemove",function(t){e.onShapeMouseMove(t)}),this.shape.on("mouseup",function(t){e.onShapeMouseUp(t)})}},{key:"setPosition",value:function(t){this.position=new f(t),this.shape.set({left:this.position.x,top:this.position.y}),this.emit("update:links");try{this.shape.canvas.renderAll()}catch(t){console.error(t)}}},{key:"setRotation",value:function(t){this.rotation=t,this.shape.set({angle:this.rotation});try{this.shape.canvas.renderAll()}catch(t){console.error(t)}}},{key:"setLinks",value:function(t){this.links=t,this.addLinks()}},{key:"addLinks",value:function(){var n=this;this.connectors=[],this.links.forEach(function(t){var e=new kt(n,t);n.connectors.push(e)}),this.addConnectors()}},{key:"addConnectors",value:function(){var e=this;this.connectors.forEach(function(t){e._map.addLayer(t)})}},{key:"onAdded",value:function(){this.addConnectors()}},{key:"onShapeDrag",value:function(){var t=N(this.shape.calcTransformMatrix(),6),e=t[4],n=t[5];this.position=new f(e,n),this.emit("update:links"),this.emit("moving")}},{key:"onShapeMouseDown",value:function(t){console.log(t),this.dragStart=t}},{key:"onShapeMouseMove",value:function(){this.dragStart&&(this.emit("dragstart"),this.dragging=!0,this.dragStart=null),this.dragging?this.emit("drag"):this.emit("hover")}},{key:"onShapeMouseUp",value:function(){this.dragging?this.emit("moved"):this.emit("click"),this.dragStart=null,this.dragging=!1}}]),o}(),jt=function(t){function n(t){var e;return G(this,n),(e=h(this,u(n).call(this,t))).defaults=Object.assign({},ut),Object.assign({},e.defaults),Object.assign({},e._options),e}return c(n,fabric.Image),n}(),Et=function(t){function e(t){return G(this,e),t=t||{},h(this,u(e).call(this,t))}return c(e,mt),e}(),Lt=function(t){function i(t,e){var n;return G(this,i),(e=e||{}).points=t||[],(n=h(this,u(i).call(this,e))).lines=[],n.class="polyline",n.strokeWidth=1,n.lineOptions={strokeWidth:n.strokeWidth,stroke:n.color||"grey",fill:n.fill||!1},n.shape=new mt([],{selectable:!1,hasControls:!1,class:n.class,parent:l(n)}),n.setPoints(n._points),n}return c(i,bt),a(i,[{key:"addPoint",value:function(t){if(this.points.push(new f(t)),1<this.points.length){var e=this.points.length-1,n=this.points.length-2,i=this.points[e],o=this.points[n],r=new fabric.Line(i.getArray().concat(o.getArray()),this.lineOptions);this.lines.push(r),this.shape.addWithUpdate(r)}}},{key:"setStrokeWidth",value:function(e){this.lines.forEach(function(t){t.setStrokeWidth(e)})}},{key:"setPoints",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.removeLines(),this.points=[];for(var e=0;e<t.length;e+=1){var n=new f(t[e]);this.points.push(n),this.addPoint()}}},{key:"removeLines",value:function(){for(var t=0;t<this.lines.length;t+=1)this.shape.remove(this.lines[t]);this.lines=[]}}]),i}(),Ct=function(t){function n(t){var e;return G(this,n),e=h(this,u(n).call(this,t)),console.log("circle"),e}return c(n,fabric.Circle),n}();console.log("fabricJS ",e.fabric.version),console.log("IndoorJS ",n),t.Circle=Ct,t.Connector=kt,t.Floor=wt,t.Group=mt,t.Icon=jt,t.Layer=bt,t.Line=xt,t.Map=yt,t.Marker=Ot,t.MarkerGroup=Et,t.Point=f,t.Polyline=Lt,t.circle=function(t){return new Ct(t)},t.connector=function(t,e,n){return new kt(t,e,n)},t.floorplan=function(t){return new wt(t)},t.group=function(t,e){return new mt(t,e)},t.icon=function(t){return new jt(t)},t.layer=function(t){return new bt(t)},t.line=function(t,e){return new xt(t,e)},t.map=function(t,e){return new yt(t,e)},t.marker=function(t,e){return new Ot(t,e)},t.markerGroup=function(t){return new Et(t)},t.point=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return o(f,e)},t.polyline=function(t,e){return new Lt(t,e)},t.version=n,Object.defineProperty(t,"__esModule",{value:!0})});